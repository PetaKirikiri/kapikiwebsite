{"ast":null,"code":"var _s = $RefreshSig$();\nimport React, { useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { sendEmail, handleAuthCallback } from './emailService';\n\n// Get the base URL considering the basename\nconst getBaseUrl = () => {\n  const isLocal = window.location.hostname === \"localhost\";\n  return isLocal ? \"/kapikiwebsite\" : \"/Ka-Piki\";\n};\nconst OAuthCallback = () => {\n  _s();\n  const navigate = useNavigate();\n  useEffect(() => {\n    const handleCallback = async () => {\n      try {\n        const urlParams = new URLSearchParams(window.location.search);\n        const code = urlParams.get('code');\n        if (!code) {\n          throw new Error('No authorization code received');\n        }\n\n        // Get the stored return path or default to /clients\n        const returnPath = localStorage.getItem('emailAuthReturnTo') || '/clients';\n        console.log('Returning to path:', returnPath);\n\n        // Exchange the code for tokens\n        await handleAuthCallback(code);\n\n        // Clear the stored path\n        localStorage.removeItem('emailAuthReturnTo');\n\n        // Navigate to the return path, ensuring we don't duplicate the base path\n        const finalPath = returnPath.startsWith(getBaseUrl()) ? returnPath : getBaseUrl() + returnPath;\n        console.log('Final navigation path:', finalPath);\n        navigate(finalPath);\n      } catch (error) {\n        console.error('OAuth callback error:', error);\n        navigate(getBaseUrl() + '/clients');\n      }\n    };\n    handleCallback();\n  }, [navigate]);\n  return null; // This component doesn't render anything\n};\n_s(OAuthCallback, \"0pNeyzXk/ByIxyERsdaIrG6js9s=\", false, function () {\n  return [useNavigate];\n});\n_c = OAuthCallback;\nexport default OAuthCallback;\nvar _c;\n$RefreshReg$(_c, \"OAuthCallback\");","map":{"version":3,"names":["React","useEffect","useNavigate","sendEmail","handleAuthCallback","getBaseUrl","isLocal","window","location","hostname","OAuthCallback","_s","navigate","handleCallback","urlParams","URLSearchParams","search","code","get","Error","returnPath","localStorage","getItem","console","log","removeItem","finalPath","startsWith","error","_c","$RefreshReg$"],"sources":["/Users/petakirikiri/Coding/Ka Piki/src/services/oauthCallback.jsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { sendEmail, handleAuthCallback } from './emailService';\n\n// Get the base URL considering the basename\nconst getBaseUrl = () => {\n  const isLocal = window.location.hostname === \"localhost\";\n  return isLocal ? \"/kapikiwebsite\" : \"/Ka-Piki\";\n};\n\nconst OAuthCallback = () => {\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const handleCallback = async () => {\n      try {\n        const urlParams = new URLSearchParams(window.location.search);\n        const code = urlParams.get('code');\n        \n        if (!code) {\n          throw new Error('No authorization code received');\n        }\n\n        // Get the stored return path or default to /clients\n        const returnPath = localStorage.getItem('emailAuthReturnTo') || '/clients';\n        console.log('Returning to path:', returnPath);\n\n        // Exchange the code for tokens\n        await handleAuthCallback(code);\n        \n        // Clear the stored path\n        localStorage.removeItem('emailAuthReturnTo');\n        \n        // Navigate to the return path, ensuring we don't duplicate the base path\n        const finalPath = returnPath.startsWith(getBaseUrl()) \n          ? returnPath \n          : getBaseUrl() + returnPath;\n        console.log('Final navigation path:', finalPath);\n        navigate(finalPath);\n      } catch (error) {\n        console.error('OAuth callback error:', error);\n        navigate(getBaseUrl() + '/clients');\n      }\n    };\n\n    handleCallback();\n  }, [navigate]);\n\n  return null; // This component doesn't render anything\n};\n\nexport default OAuthCallback; "],"mappings":";AAAA,OAAOA,KAAK,IAAIC,SAAS,QAAQ,OAAO;AACxC,SAASC,WAAW,QAAQ,kBAAkB;AAC9C,SAASC,SAAS,EAAEC,kBAAkB,QAAQ,gBAAgB;;AAE9D;AACA,MAAMC,UAAU,GAAGA,CAAA,KAAM;EACvB,MAAMC,OAAO,GAAGC,MAAM,CAACC,QAAQ,CAACC,QAAQ,KAAK,WAAW;EACxD,OAAOH,OAAO,GAAG,gBAAgB,GAAG,UAAU;AAChD,CAAC;AAED,MAAMI,aAAa,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAC1B,MAAMC,QAAQ,GAAGV,WAAW,CAAC,CAAC;EAE9BD,SAAS,CAAC,MAAM;IACd,MAAMY,cAAc,GAAG,MAAAA,CAAA,KAAY;MACjC,IAAI;QACF,MAAMC,SAAS,GAAG,IAAIC,eAAe,CAACR,MAAM,CAACC,QAAQ,CAACQ,MAAM,CAAC;QAC7D,MAAMC,IAAI,GAAGH,SAAS,CAACI,GAAG,CAAC,MAAM,CAAC;QAElC,IAAI,CAACD,IAAI,EAAE;UACT,MAAM,IAAIE,KAAK,CAAC,gCAAgC,CAAC;QACnD;;QAEA;QACA,MAAMC,UAAU,GAAGC,YAAY,CAACC,OAAO,CAAC,mBAAmB,CAAC,IAAI,UAAU;QAC1EC,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAEJ,UAAU,CAAC;;QAE7C;QACA,MAAMhB,kBAAkB,CAACa,IAAI,CAAC;;QAE9B;QACAI,YAAY,CAACI,UAAU,CAAC,mBAAmB,CAAC;;QAE5C;QACA,MAAMC,SAAS,GAAGN,UAAU,CAACO,UAAU,CAACtB,UAAU,CAAC,CAAC,CAAC,GACjDe,UAAU,GACVf,UAAU,CAAC,CAAC,GAAGe,UAAU;QAC7BG,OAAO,CAACC,GAAG,CAAC,wBAAwB,EAAEE,SAAS,CAAC;QAChDd,QAAQ,CAACc,SAAS,CAAC;MACrB,CAAC,CAAC,OAAOE,KAAK,EAAE;QACdL,OAAO,CAACK,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;QAC7ChB,QAAQ,CAACP,UAAU,CAAC,CAAC,GAAG,UAAU,CAAC;MACrC;IACF,CAAC;IAEDQ,cAAc,CAAC,CAAC;EAClB,CAAC,EAAE,CAACD,QAAQ,CAAC,CAAC;EAEd,OAAO,IAAI,CAAC,CAAC;AACf,CAAC;AAACD,EAAA,CAvCID,aAAa;EAAA,QACAR,WAAW;AAAA;AAAA2B,EAAA,GADxBnB,aAAa;AAyCnB,eAAeA,aAAa;AAAC,IAAAmB,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}