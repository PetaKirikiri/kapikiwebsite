{"ast":null,"code":"var _jsxFileName = \"/Users/petakirikiri/Coding/Ka Piki/src/pages/OAuthCallback.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect } from 'react';\nimport { useNavigate, useSearchParams, useLocation } from 'react-router-dom';\nimport { handleAuthCallback } from '../services/emailService';\nimport '../styles/spinner.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function OAuthCallback() {\n  _s();\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const location = useLocation();\n  useEffect(() => {\n    async function handleAuth() {\n      try {\n        // Log everything about our current location\n        console.log('OAuth Callback: Full URL:', window.location.href);\n        console.log('OAuth Callback: Current pathname:', location.pathname);\n        console.log('OAuth Callback: Search params:', Object.fromEntries(searchParams.entries()));\n        const code = searchParams.get('code');\n        if (!code) {\n          console.error('OAuth Callback: No authorization code received');\n          navigate('/clients', {\n            replace: true\n          });\n          return;\n        }\n        console.log('OAuth Callback: Starting token exchange with code length:', code.length);\n        try {\n          // Exchange the code for tokens\n          const accessToken = await handleAuthCallback(code);\n          console.log('OAuth Callback: Token exchange successful:', !!accessToken);\n\n          // Check if we got the refresh token\n          const hasRefreshToken = !!localStorage.getItem('gmail_refresh_token');\n          console.log('OAuth Callback: Refresh token stored:', hasRefreshToken);\n          if (!hasRefreshToken) {\n            console.error('OAuth Callback: No refresh token received after successful exchange');\n          }\n        } catch (error) {\n          console.error('OAuth Callback: Token exchange failed:', error);\n          // Even if token exchange fails, try to navigate back\n        }\n\n        // Always try to navigate back\n        let returnTo = localStorage.getItem('emailAuthReturnTo');\n        console.log('OAuth Callback: Stored return path:', returnTo);\n\n        // Clean up\n        localStorage.removeItem('emailAuthReturnTo');\n\n        // Default to clients page if no return path or if it's the oauth page\n        if (!returnTo || returnTo.includes('oauth-callback')) {\n          returnTo = '/clients';\n        }\n\n        // Remove any duplicate slashes and ensure proper format\n        returnTo = '/' + returnTo.split('/').filter(Boolean).join('/');\n        console.log('OAuth Callback: Navigating to:', returnTo);\n        navigate(returnTo, {\n          replace: true\n        });\n      } catch (error) {\n        console.error('OAuth Callback: Unexpected error:', error);\n        // Always try to get back to a valid page\n        navigate('/clients', {\n          replace: true\n        });\n      }\n    }\n\n    // Start the auth handling process\n    console.log('OAuth Callback: Component mounted, starting auth process');\n    handleAuth();\n  }, [navigate, searchParams, location]);\n\n  // Show a loading state while we process\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      minHeight: '100vh',\n      backgroundColor: '#f9fafb'\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        textAlign: 'center',\n        padding: '2rem',\n        backgroundColor: 'white',\n        borderRadius: '8px',\n        boxShadow: '0 1px 3px rgba(0, 0, 0, 0.1)'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        style: {\n          fontSize: '1.25rem',\n          fontWeight: '600',\n          marginBottom: '1rem'\n        },\n        children: \"Setting Up Email Access\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: '#4b5563',\n          marginBottom: '1rem'\n        },\n        children: \"Please wait while we complete the setup...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: '32px',\n          height: '32px',\n          border: '2px solid #f3f3f3',\n          borderTop: '2px solid #3b82f6',\n          borderRadius: '50%',\n          animation: 'spin 1s linear infinite',\n          margin: '0 auto'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          fontSize: '0.875rem',\n          color: '#6b7280',\n          marginTop: '1rem'\n        },\n        children: \"This should only take a moment.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 5\n  }, this);\n}\n_s(OAuthCallback, \"s6h7hCU1sROhTNGDKP2n93e7qmE=\", false, function () {\n  return [useNavigate, useSearchParams, useLocation];\n});\n_c = OAuthCallback;\nvar _c;\n$RefreshReg$(_c, \"OAuthCallback\");","map":{"version":3,"names":["React","useEffect","useNavigate","useSearchParams","useLocation","handleAuthCallback","jsxDEV","_jsxDEV","OAuthCallback","_s","navigate","searchParams","location","handleAuth","console","log","window","href","pathname","Object","fromEntries","entries","code","get","error","replace","length","accessToken","hasRefreshToken","localStorage","getItem","returnTo","removeItem","includes","split","filter","Boolean","join","style","display","alignItems","justifyContent","minHeight","backgroundColor","children","textAlign","padding","borderRadius","boxShadow","fontSize","fontWeight","marginBottom","fileName","_jsxFileName","lineNumber","columnNumber","color","width","height","border","borderTop","animation","margin","marginTop","_c","$RefreshReg$"],"sources":["/Users/petakirikiri/Coding/Ka Piki/src/pages/OAuthCallback.jsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { useNavigate, useSearchParams, useLocation } from 'react-router-dom';\nimport { handleAuthCallback } from '../services/emailService';\nimport '../styles/spinner.css';\n\nexport default function OAuthCallback() {\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const location = useLocation();\n\n  useEffect(() => {\n    async function handleAuth() {\n      try {\n        // Log everything about our current location\n        console.log('OAuth Callback: Full URL:', window.location.href);\n        console.log('OAuth Callback: Current pathname:', location.pathname);\n        console.log('OAuth Callback: Search params:', Object.fromEntries(searchParams.entries()));\n        \n        const code = searchParams.get('code');\n        if (!code) {\n          console.error('OAuth Callback: No authorization code received');\n          navigate('/clients', { replace: true });\n          return;\n        }\n\n        console.log('OAuth Callback: Starting token exchange with code length:', code.length);\n        \n        try {\n          // Exchange the code for tokens\n          const accessToken = await handleAuthCallback(code);\n          console.log('OAuth Callback: Token exchange successful:', !!accessToken);\n\n          // Check if we got the refresh token\n          const hasRefreshToken = !!localStorage.getItem('gmail_refresh_token');\n          console.log('OAuth Callback: Refresh token stored:', hasRefreshToken);\n\n          if (!hasRefreshToken) {\n            console.error('OAuth Callback: No refresh token received after successful exchange');\n          }\n        } catch (error) {\n          console.error('OAuth Callback: Token exchange failed:', error);\n          // Even if token exchange fails, try to navigate back\n        }\n\n        // Always try to navigate back\n        let returnTo = localStorage.getItem('emailAuthReturnTo');\n        console.log('OAuth Callback: Stored return path:', returnTo);\n        \n        // Clean up\n        localStorage.removeItem('emailAuthReturnTo');\n\n        // Default to clients page if no return path or if it's the oauth page\n        if (!returnTo || returnTo.includes('oauth-callback')) {\n          returnTo = '/clients';\n        }\n\n        // Remove any duplicate slashes and ensure proper format\n        returnTo = '/' + returnTo.split('/').filter(Boolean).join('/');\n        \n        console.log('OAuth Callback: Navigating to:', returnTo);\n        navigate(returnTo, { replace: true });\n\n      } catch (error) {\n        console.error('OAuth Callback: Unexpected error:', error);\n        // Always try to get back to a valid page\n        navigate('/clients', { replace: true });\n      }\n    }\n\n    // Start the auth handling process\n    console.log('OAuth Callback: Component mounted, starting auth process');\n    handleAuth();\n  }, [navigate, searchParams, location]);\n\n  // Show a loading state while we process\n  return (\n    <div style={{\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      minHeight: '100vh',\n      backgroundColor: '#f9fafb'\n    }}>\n      <div style={{\n        textAlign: 'center',\n        padding: '2rem',\n        backgroundColor: 'white',\n        borderRadius: '8px',\n        boxShadow: '0 1px 3px rgba(0, 0, 0, 0.1)'\n      }}>\n        <h2 style={{\n          fontSize: '1.25rem',\n          fontWeight: '600',\n          marginBottom: '1rem'\n        }}>Setting Up Email Access</h2>\n        <p style={{\n          color: '#4b5563',\n          marginBottom: '1rem'\n        }}>Please wait while we complete the setup...</p>\n        <div style={{\n          width: '32px',\n          height: '32px',\n          border: '2px solid #f3f3f3',\n          borderTop: '2px solid #3b82f6',\n          borderRadius: '50%',\n          animation: 'spin 1s linear infinite',\n          margin: '0 auto'\n        }}></div>\n        <p style={{\n          fontSize: '0.875rem',\n          color: '#6b7280',\n          marginTop: '1rem'\n        }}>This should only take a moment.</p>\n      </div>\n    </div>\n  );\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}